<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sebuah Cerita Tentang Kita</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000;
            cursor: pointer;
        }
        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        .ui-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 10;
            color: white;
            font-family: 'Dancing Script', cursive;
            text-align: center;
            pointer-events: none;
        }
        #prompt {
            font-size: clamp(2rem, 5vw, 3rem);
            text-shadow: 0 0 15px rgba(255, 182, 193, 0.8);
            opacity: 1;
            transition: opacity 1.5s ease;
        }
        #finalMessage {
            font-size: clamp(2.5rem, 6vw, 4rem);
            text-shadow: 0 0 20px #ff69b4, 0 0 30px #ff69b4;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1.5s ease, transform 1.5s ease;
            position: absolute;
            bottom: 10%;
        }
        #musicButton {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.4);
            color: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            z-index: 100;
            pointer-events: all;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
    </style>
</head>
<body>
    <!-- 
      PENTING! GANTI URL GAMBAR DI BAWAH INI DENGAN FOTO KAMU.
      Gunakan link gambar langsung (misal dari Imgur, Postimages, dll).
      Pastikan fotonya berbentuk potret (berdiri) untuk hasil terbaik.
    -->
    <img id="sourceImage" src="https://placehold.co/400x600/ffc0cb/333?text=Foto+Kalian" style="display:none;" crossOrigin="anonymous">

    <canvas id="particleCanvas"></canvas>
    
    <div class="ui-container">
        <h1 id="prompt">Klik di mana saja untuk memulai...</h1>
        <h2 id="finalMessage">Kaulah duniaku.</h2>
    </div>

    <button id="musicButton">ðŸŽµ</button>

    <script>
        const canvas = document.getElementById('particleCanvas');
        const ctx = canvas.getContext('2d');
        const sourceImage = document.getElementById('sourceImage');
        const promptEl = document.getElementById('prompt');
        const finalMessageEl = document.getElementById('finalMessage');
        const musicButton = document.getElementById('musicButton');

        let particles = [];
        let hasStarted = false;
        let musicPlaying = false;
        const mouse = { x: null, y: null, radius: 100 };

        // --- MUSIK ROMANTIS ---
        const synth = new Tone.PolySynth(Tone.Synth, {
            oscillator: { type: "fmsine", modulationType: "sine", harmonicity: 1.01 },
            envelope: { attack: 0.1, decay: 0.2, sustain: 0.5, release: 1.2 },
        }).toDestination();
        synth.volume.value = -8;

        const melody = new Tone.Sequence((time, note) => {
            synth.triggerAttackRelease(note, "2n", time);
        }, [
            ['C4', 'E4', 'G4'], null, ['A3', 'C4', 'E4'], null, 
            ['F3', 'A3', 'C4'], null, ['G3', 'B3', 'D4'], null
        ], "1m");
        melody.loop = true;

        musicButton.addEventListener('click', () => {
            if (Tone.context.state !== 'running') Tone.context.resume();
            if (!musicPlaying) {
                Tone.Transport.start();
                melody.start(0);
                musicPlaying = true;
                musicButton.textContent = 'ðŸ”‡';
            } else {
                melody.stop();
                Tone.Transport.stop();
                musicPlaying = false;
                musicButton.textContent = 'ðŸŽµ';
            }
        });

        // --- PARTIKEL & FISIKA ---
        class Particle {
            constructor(targetX, targetY, color) {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.targetX = targetX;
                this.targetY = targetY;
                this.color = color;
                this.size = 2;
                this.vx = 0;
                this.vy = 0;
                this.ease = 0.05;
                this.friction = 0.92;
                this.repelForce = 5;
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }

            update() {
                // Interaksi dengan mouse
                let dxMouse = this.x - mouse.x;
                let dyMouse = this.y - mouse.y;
                let distanceMouse = Math.sqrt(dxMouse * dxMouse + dyMouse * dyMouse);
                
                if (distanceMouse < mouse.radius) {
                    let angle = Math.atan2(dyMouse, dxMouse);
                    let force = (mouse.radius - distanceMouse) / mouse.radius * this.repelForce;
                    this.vx += Math.cos(angle) * force;
                    this.vy += Math.sin(angle) * force;
                }

                // Gerak menuju target
                let dxTarget = this.targetX - this.x;
                let dyTarget = this.targetY - this.y;
                this.vx += dxTarget * this.ease;
                this.vy += dyTarget * this.ease;

                this.vx *= this.friction;
                this.vy *= this.friction;

                this.x += this.vx;
                this.y += this.vy;
            }
        }

        function initParticles() {
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            const imgWidth = sourceImage.width;
            const imgHeight = sourceImage.height;

            const scale = Math.min((canvas.height * 0.7) / imgHeight, (canvas.width * 0.7) / imgWidth);
            const scaledWidth = imgWidth * scale;
            const scaledHeight = imgHeight * scale;
            
            tempCanvas.width = scaledWidth;
            tempCanvas.height = scaledHeight;
            tempCtx.drawImage(sourceImage, 0, 0, scaledWidth, scaledHeight);
            const imageData = tempCtx.getImageData(0, 0, scaledWidth, scaledHeight).data;

            const offsetX = (canvas.width - scaledWidth) / 2;
            const offsetY = (canvas.height - scaledHeight) / 2;

            const density = 4; // Turunkan nilai ini untuk partikel lebih rapat (lebih berat)

            for (let y = 0; y < scaledHeight; y += density) {
                for (let x = 0; x < scaledWidth; x += density) {
                    const i = (y * scaledWidth + x) * 4;
                    if (imageData[i+3] > 128) { // Hanya ambil pixel yang tidak transparan
                        const r = imageData[i];
                        const g = imageData[i+1];
                        const b = imageData[i+2];
                        const color = `rgb(${r},${g},${b})`;
                        
                        // Cek apakah pixel berada di dalam bentuk hati
                        let heartX = (x - scaledWidth / 2) / (scaledWidth / 2);
                        let heartY = (y - scaledHeight / 2) / (scaledHeight / 1.8);
                        
                        let val = heartX*heartX + Math.pow(1.25*heartY - 1.25*Math.sqrt(Math.abs(heartX)), 2);

                        if (val <= 1) {
                             particles.push(new Particle(x + offsetX, y + offsetY, color));
                        }
                    }
                }
            }
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            requestAnimationFrame(animate);
        }

        function setup() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = [];
            if (hasStarted) {
                initParticles();
            }
        }

        // --- EVENT LISTENERS ---
        window.addEventListener('resize', setup);
        
        window.addEventListener('mousemove', (e) => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
        });
        
        window.addEventListener('mouseout', () => {
            mouse.x = null;
            mouse.y = null;
        });

        window.addEventListener('click', () => {
            if (hasStarted) return;
            hasStarted = true;
            
            promptEl.style.opacity = '0';
            
            // Mulai musik jika belum
            if (!musicPlaying) {
                musicButton.click();
            }
            
            initParticles();
            animate();

            setTimeout(() => {
                finalMessageEl.style.opacity = '1';
                finalMessageEl.style.transform = 'translateY(0)';
            }, 4000); // Pesan muncul setelah partikel mulai berkumpul
        });
        
        sourceImage.onload = setup;
    </script>
</body>
</html>

