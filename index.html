<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Karna Kamu Cantik â€” Scrapbook 3D (Versi Final)</title>

    <!-- Tailwind CSS (Untuk Desain Modern) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&family=Dancing+Script:wght@700&family=Merriweather:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    
    <!-- Animate.css (Untuk Animasi Konten) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        :root {
            --duration: 1.2s;
            --mouse-x: 50%;
            --mouse-y: 50%;
        }
        body {
            font-family: 'Merriweather', serif;
            background-color: #1a202c;
            background-image: 
                url('data:image/svg+xml,%3Csvg viewBox="0 0 250 250" xmlns="http://www.w3.org/2000/svg"%3E%3Cfilter id="noiseFilter"%3E%3CfeTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="3" stitchTiles="stitch"/%3E%3C/filter%3E%3Crect width="100%" height="100%" filter="url(%23noiseFilter)" opacity="0.1"/%3E%3C/svg%3E');
            overflow: hidden;
            cursor: default;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at var(--mouse-x) var(--mouse-y), rgba(182, 132, 240, 0.15), transparent 40vw);
            z-index: 0;
            pointer-events: none;
            transition: background 0.2s ease-out;
        }
        #vignette-overlay {
            position: fixed;
            inset: 0;
            box-shadow: inset 0 0 15vw rgba(0,0,0,0.5);
            pointer-events: none;
            z-index: 10;
        }
        #sparkles-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }
        .font-title { font-family: 'Dancing Script', cursive; }
        .font-handwriting { font-family: 'Caveat', cursive; }
        .book { 
            transform-style: preserve-3d; 
            position: relative; 
            z-index: 2; 
            touch-action: pan-y;
            transition: transform 1s cubic-bezier(0.645, 0.045, 0.355, 1);
        }
        /* PERUBAHAN: State awal buku miring */
        .book.is-closed-initial {
            transform: scale(0.9) rotateX(10deg) rotateY(-20deg);
        }
        .book-spine { position: absolute; left: 50%; top: 0; bottom: 0; width: 50px; transform: translateX(-50%); background: linear-gradient(to right, rgba(0,0,0,0.15), rgba(0,0,0,0) 5%, rgba(0,0,0,0) 95%, rgba(0,0,0,0.15)); z-index: 1; }
        .page-leaf { transition: transform var(--duration) cubic-bezier(0.645, 0.045, 0.355, 1); transform-origin: left center; transform-style: preserve-3d; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .page-leaf.is-flipped { transform: rotateY(-180deg); box-shadow: none; }
        .page-front, .page-back { backface-visibility: hidden; -webkit-backface-visibility: hidden; background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23d4d4d4" fill-opacity="0.07"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E'); }
        .page-back { transform: rotateY(180deg); }
        .content-container .animated { visibility: hidden; }
        .is-current .content-container .animated { visibility: visible; }
        .polaroid { background: #fff; padding: 0.5rem; padding-bottom: 3rem; box-shadow: 0 5px 15px rgba(0,0,0,0.2); border-radius: 4px; position: relative; transition: transform 0.3s ease; cursor: pointer; }
        @media (min-width: 768px) { .polaroid { padding: 1rem; padding-bottom: 3.5rem; } }
        .polaroid:hover { transform: scale(1.03) rotate(var(--hover-rotate, 0deg)) !important; z-index: 10; }
        .text-gold-foil { background: linear-gradient(100deg, #d2b48c, #fff, #b8860b, #fff, #d2b48c); background-size: 200% 200%; color: transparent; background-clip: text; -webkit-background-clip: text; animation: gold-shine 5s linear infinite; }
        @keyframes gold-shine { 0% { background-position: 200% center; } 100% { background-position: 0% center; } }
        .washi-tape { width: 100px; height: 25px; background-color: rgba(255, 224, 130, 0.7); background-image: linear-gradient(45deg, rgba(251, 191, 36, 0.3) 25%, transparent 25%, transparent 50%, rgba(251, 191, 36, 0.3) 50%, rgba(251, 191, 36, 0.3) 75%, transparent 75%, transparent); background-size: 20px 20px; backdrop-filter: blur(2px); border-left: 2px dashed rgba(255,255,255,0.4); border-right: 2px dashed rgba(255,255,255,0.4); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .sticker { position: absolute; width: 30px; height: 30px; opacity: 0.8; pointer-events: none; }
        #lightbox { transition: opacity 0.3s ease; }
        @media (orientation: portrait) and (max-width: 767px) { #landscape-suggestion { display: flex; } }
    </style>
</head>
<body class="flex items-center justify-center h-screen antialiased text-gray-800">
    <div id="vignette-overlay"></div>
    <canvas id="sparkles-canvas"></canvas>

    <div id="landscape-suggestion" class="fixed top-0 left-0 w-full bg-yellow-400 text-black text-sm text-center p-2 z-50 hidden items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M16.466 7.5C15.643 4.237 13.952 2 12 2 9.239 2 7 6.477 7 12s2.239 10 5 10c.342 0 .677-.069 1-.2"/><path d="m21.5 10.5-1.9-1.9-1.9 1.9"/><path d="M3.5 13.5 5.4 15.4l1.9-1.9"/></svg>
        Putar perangkat Anda untuk pengalaman terbaik
    </div>
    
    <audio id="song" preload="auto"></audio>
    <audio id="flipSound" src="https://cdn.freesound.org/previews/466/466088_10023392-lq.mp3" preload="auto"></audio>

    <div class="relative w-[95vw] h-[80vh] md:w-[80vw] md:h-[75vh] max-w-5xl max-h-[640px] book is-closed-initial" id="book">
        <div class="book-spine"></div>
        <div class="w-full h-full relative perspective-[2500px]" id="page-container"></div>

        <div class="absolute bottom-4 md:bottom-6 left-1/2 -translate-x-1/2 flex items-center gap-3 md:gap-4 z-50">
            <button class="btn" id="prevBtn" aria-label="Halaman Sebelumnya"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button>
            <button class="btn-play" id="playPauseBtn" aria-label="Putar atau Jeda Musik">
                 <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                 <svg id="pause-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
            </button>
            <button class="btn" id="nextBtn" aria-label="Halaman Berikutnya"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg></button>
        </div>

        <div id="progress-container" class="absolute bottom-0 left-0 w-full h-2.5 bg-white/20 cursor-pointer group">
            <div id="progress-bar" class="h-full bg-rose-400 transition-all duration-200 group-hover:h-full relative"><div class="absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"></div></div>
        </div>
    </div>

    <div id="lightbox" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <img id="lightbox-img" src="" class="max-w-full max-h-full object-contain rounded-lg shadow-2xl">
        <button id="lightbox-close" class="absolute top-4 right-4 text-white text-4xl">&times;</button>
    </div>

    <script>
        const book = document.getElementById('book');
        const song = document.getElementById('song');
        const flipSound = document.getElementById('flipSound');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const pageContainer = document.getElementById('page-container');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const lightboxClose = document.getElementById('lightbox-close');
        
        let slides = [];
        let currentIndex = 0;
        let pageLeaves = [];

        const stickers = [ `<svg class="sticker" viewBox="0 0 24 24" fill="rgba(239, 68, 68, 0.7)"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`, `<svg class="sticker" viewBox="0 0 24 24" fill="rgba(251, 191, 36, 0.7)"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>` ];
        
        const storyData = {
            "title": "Karna Kamu Cantik",
            "subtitle": "Sebuah Scrapbook Digital",
            "songUrl": "karna_kamu_cantik.mp3",
            "slides": [
                { "time": 2, "photo": "https://lh3.googleusercontent.com/d/1MCz__oWks-PFIMmFFRvX1TLUCSCdw2af", "text": "Bukan kar'na make up di wajahmu" },
                { "time": 6, "photo": "https://lh3.googleusercontent.com/d/1JAzxovbqrARfVb_rDluM86vbPd2wC-94", "text": "Atau lipstik merah itu (di bibirmu)" },
                { "time": 10, "photo": "https://lh3.googleusercontent.com/d/1MeAALc36r8x1yQgZz8k0F0sKnwmDbv7_", "text": "Lembut hati tutur kata" },
                { "time": 13, "photo": "https://lh3.googleusercontent.com/d/1HtYq9oXEQ3OrLY9RNRCVGKuuA2D8a4QX", "text": "Terciptalah cinta yang kupuja" },
                { "time": 18, "photo": "https://lh3.googleusercontent.com/d/1NJ_e5-AArmf7r3aVkFjfUxjZmQfXY6A3", "text": "Tak peduli langit menertawakanku" },
                { "time": 26, "photo": "https://lh3.googleusercontent.com/d/1NQJl6DNU2Sut4swsTrTrbniHZcqHBf2A", "text": "Kau mencuri hatiku, mimpiku, semua rinduku" },
                { "time": 36, "photo": "https://lh3.googleusercontent.com/d/1Ov5TKr6KbPMc5_nvtfmNjTyqHJiqHS60", "text": "Kar'na kamu cantik" },
                { "time": 40, "photo": "https://lh3.googleusercontent.com/d/1ORmUGB3EXGj2GAuDcI1VpSqmGr6H79ZT", "text": "'Kan kuberi s'galanya apa yang kupunya" },
                { "time": 44, "photo": "https://lh3.googleusercontent.com/d/1PLG2FA111Z8xmyvnqKL0X7YmjpKRfmVk", "text": "Dan hatimu baik" },
                { "time": 48, "photo": "https://lh3.googleusercontent.com/d/1Pg3OMfBCGFQHF2YCrNDmsUIwsTsejuyw", "text": "Sempurnalah duniaku saat kau di sisiku" }
            ]
        };

        function loadStory() {
            try {
                const data = storyData;
                slides = data.slides;
                song.src = data.songUrl;
                createBook(data);
                showPage(0);
                book.setAttribute('data-initialized', 'true');
            } catch (error) {
                console.error(error);
                pageContainer.innerHTML = `<div class="text-white text-center p-8">Gagal memuat cerita.<br>Silakan coba lagi.</div>`;
            }
        }

        function createBook(story) {
            pageLeaves = []; pageContainer.innerHTML = '';
            
            const totalPages = slides.length + 1;
            for (let i = 0; i < totalPages; i++) {
                const leaf = document.createElement('div'); leaf.className = 'page-leaf absolute w-1/2 h-full top-0 right-0';
                const front = document.createElement('div'); front.className = 'page-front absolute w-full h-full bg-white rounded-r-lg flex items-center justify-center p-2 md:p-8';
                const back = document.createElement('div'); back.className = 'page-back absolute w-full h-full bg-white rounded-l-lg flex items-center justify-center p-2 md:p-8';
                
                if (i === 0) {
                    const staticCoverBack = document.createElement('div'); staticCoverBack.className = 'absolute w-1/2 h-full top-0 left-0 bg-[#2c3e50] rounded-l-lg shadow-2xl flex items-center justify-center';
                    staticCoverBack.innerHTML = `<div class='text-center text-white/80 p-4'><p class='font-title text-xl md:text-2xl'>Sebuah Cerita</p></div>`;
                    pageContainer.appendChild(staticCoverBack);
                    front.classList.remove('bg-white', 'p-2', 'md:p-8'); front.classList.add('bg-[#34495e]', 'text-white', 'flex-col', 'rounded-lg');
                    front.innerHTML = `<div class="text-center p-4"><h1 class="font-title text-3xl md:text-6xl text-gold-foil">${story.title}</h1><p class="mt-2 md:mt-4 text-xs md:text-base text-white/80">${story.subtitle}</p></div>`;
                }
                if (i === totalPages - 1) { 
                    back.classList.add('bg-slate-100'); 
                    back.innerHTML = `<div class="p-4 text-center"><h3 class="font-title text-2xl md:text-4xl">Tamat</h3></div>`; 
                }
                if (i > 0 && slides[i - 1]) {
                    front.innerHTML = `<div class="content-container text-center w-full h-full flex flex-col justify-center relative"><p class="font-handwriting text-2xl md:text-5xl leading-tight animate__animated animate__fadeInRight">${slides[i-1].text}</p></div>`;
                    if (Math.random() > 0.4) front.querySelector('.content-container').innerHTML += getRandomSticker();
                }
                if (slides[i]) {
                    const randomRotation = Math.random() * 5 - 2.5;
                    back.innerHTML = `<div class="content-container w-full h-full flex items-center justify-center p-2 md:p-4 relative"><div class="polaroid animate__animated animate__fadeInLeft relative" style="transform: rotate(${randomRotation}deg); --hover-rotate: ${randomRotation}deg;" data-src="${slides[i].photo}"><div class="washi-tape absolute -top-3 left-1/2 -translate-x-1/2 -rotate-3"></div><img src="${slides[i].photo}" onerror="this.onerror=null;this.src='https://placehold.co/600x800/e2e8f0/94a3b8?text=Gagal+Muat';" alt="Scrapbook image" class="w-full h-full object-cover bg-gray-200"></div></div>`;
                }
                leaf.appendChild(front); leaf.appendChild(back); pageLeaves.push(leaf); pageContainer.appendChild(leaf);
            }
        }
        function getRandomSticker() { const sticker = stickers[Math.floor(Math.random() * stickers.length)]; const top = Math.random() * 80 + 10; const left = Math.random() * 80 + 10; const rot = Math.random() * 60 - 30; return `<div style="top: ${top}%; left: ${left}%; transform: rotate(${rot}deg);">${sticker}</div>`; }
        
        function showPage(targetIndex) {
            const totalPages = slides.length + 1;
            if (targetIndex < 0 || targetIndex > totalPages) return;
            
            const isClosing = targetIndex === 0; 
            const isOpening = currentIndex === 0 && targetIndex > 0;
            currentIndex = targetIndex;

            pageLeaves.forEach((leaf, index) => {
                leaf.classList.toggle('is-flipped', index < currentIndex);
                
                if (index < currentIndex) {
                    leaf.style.zIndex = index + 1;
                } else {
                    leaf.style.zIndex = totalPages - index;
                }

                const isCurrent = (index === currentIndex - 1) || (index === currentIndex);
                leaf.querySelectorAll('.page-front, .page-back').forEach(p => p.classList.toggle('is-current', isCurrent));
            });
            if (isOpening || (!isClosing && book.hasAttribute('data-initialized'))) { try { flipSound.currentTime = 0; flipSound.play(); } catch (e) {} }
            if(isClosing) song.pause();
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex >= totalPages - 1;
        }

        function togglePlayPause() { 
            if (song.ended) {
                song.currentTime = 0;
            }
            if (song.paused) { 
                if (currentIndex === 0) {
                    book.classList.remove('is-closed-initial');
                    setTimeout(() => {
                       showPage(1); 
                       song.play();
                    }, 1000); // Tunggu animasi buku selesai
                } else {
                   song.play(); 
                }
            } else { 
                song.pause(); 
            } 
        }
        
        playPauseBtn.addEventListener('click', togglePlayPause);
        song.addEventListener('play', () => { playIcon.classList.add('hidden'); pauseIcon.classList.remove('hidden'); });
        song.addEventListener('pause', () => { playIcon.classList.remove('hidden'); pauseIcon.classList.add('hidden'); });
        song.addEventListener('ended', () => {
             showPage(0); // PERUBAHAN: Tutup buku
             setTimeout(() => { // Tambahkan kembali state miring setelah tertutup
                book.classList.add('is-closed-initial');
             }, 1200); // PERBAIKAN: Menggunakan nilai numerik langsung
        });

        prevBtn.addEventListener('click', () => showPage(currentIndex - 1));
        nextBtn.addEventListener('click', () => {
            const totalPages = slides.length + 1;
            if (currentIndex >= totalPages - 1) {
                song.dispatchEvent(new Event('ended'));
            } else {
                showPage(currentIndex + 1);
            }
        });
        song.addEventListener('timeupdate', () => {
            if (!song.duration) return;
            progressBar.style.width = `${(song.currentTime / song.duration) * 100}%`;
            if (song.paused) return;
            let slideIndex = -1;
            for (let i = 0; i < slides.length; i++) { if (song.currentTime >= slides[i].time) slideIndex = i; }
            if (slideIndex > -1) {
                const newTargetPage = slideIndex + 1;
                if (newTargetPage > currentIndex) showPage(newTargetPage);
            }
        });
        progressContainer.addEventListener('click', (e) => { if (song.duration) song.currentTime = (e.offsetX / progressContainer.clientWidth) * song.duration; });
        document.body.addEventListener('mousemove', e => { document.body.style.setProperty('--mouse-x', e.clientX + 'px'); document.body.style.setProperty('--mouse-y', e.clientY + 'px'); });
        
        pageContainer.addEventListener('click', e => {
            const polaroid = e.target.closest('div[data-src]');
            if (polaroid) {
                lightboxImg.src = polaroid.dataset.src;
                lightbox.classList.remove('opacity-0', 'pointer-events-none');
            }
        });
        lightboxClose.addEventListener('click', () => lightbox.classList.add('opacity-0', 'pointer-events-none'));
        lightbox.addEventListener('click', () => lightbox.classList.add('opacity-0', 'pointer-events-none'));

        let touchStartX = 0; let touchEndX = 0;
        book.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, { passive: true });
        book.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            const totalPages = slides.length + 1;
            if (touchEndX < touchStartX - 50) { // Swipe left
                if (currentIndex < totalPages - 1) showPage(currentIndex + 1);
                else nextBtn.click();
            }
            if (touchEndX > touchStartX + 50) { // Swipe right
                if (currentIndex > 0) showPage(currentIndex - 1);
            }
        });

        const canvas = document.getElementById('sparkles-canvas');
        const ctx = canvas.getContext('2d');
        let sparkles = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        function createSparkles() {
            for (let i = 0; i < 50; i++) {
                sparkles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 1.5 + 0.5,
                    speed: Math.random() * 0.5 + 0.2,
                    opacity: Math.random() * 0.5 + 0.2
                });
            }
        }

        function animateSparkles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            sparkles.forEach(sparkle => {
                sparkle.y -= sparkle.speed;
                if (sparkle.y < 0) {
                    sparkle.y = canvas.height;
                    sparkle.x = Math.random() * canvas.width;
                }
                ctx.beginPath();
                ctx.arc(sparkle.x, sparkle.y, sparkle.size, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 215, 0, ${sparkle.opacity})`;
                ctx.fill();
            });
            requestAnimationFrame(animateSparkles);
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.btn').forEach(btn => btn.className = 'w-12 h-12 bg-white/70 backdrop-blur-sm rounded-full flex items-center justify-center shadow-lg hover:bg-white transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed text-gray-700');
            document.querySelector('.btn-play').className = 'w-14 h-14 md:w-16 md:h-16 bg-rose-500 text-white rounded-full flex items-center justify-center shadow-xl hover:bg-rose-600 transition-all duration-300 transform hover:scale-105';
            loadStory();
            resizeCanvas();
            createSparkles();
            animateSparkles();
            window.addEventListener('resize', resizeCanvas);
        });
    </script>
</body>
</html>

